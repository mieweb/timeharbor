<head>
  <title>TimeHarbor - Your Personal Time Tracking Assistant</title>
  <link rel="stylesheet" href="/client/tailwind.generated.css">
  <!-- AG Grid CSS -->
  <link rel="stylesheet" href="https://unpkg.com/ag-grid-community/styles/ag-grid.css">
  <link rel="stylesheet" href="https://unpkg.com/ag-grid-community/styles/ag-theme-alpine.css">

  <!-- Ozwell Chat Widget Styles -->
  <link rel="stylesheet" href="/chat-wrapper.css">

  <!-- Ozwell Widget Configuration -->
  <script>
    window.OzwellChatConfig = {
      widgetUrl: 'http://localhost:3000/embed/widget.html',
      endpoint: 'http://localhost:3000/embed/chat',
      title: 'TimeHarbor Assistant',
      placeholder: 'Ask about your tickets...',
      model: 'qwen2.5:14b',
      systemPrompt: `You are a helpful assistant for TimeHarbor ticket tracking.

**IMPORTANT: Always respond in English. Never use Thai or any other language.**

CRITICAL TOOL USAGE RULES - READ CAREFULLY:

1. WHEN TO USE TOOLS:
   ✅ User says: "update", "change", "set", "modify", "fill in", "add to", "use this"
   ✅ User confirms: "yes", "ok do it", "proceed", "apply it"
   ✅ User checks: "what is the current...", "show me what's filled"

2. WHEN NOT TO USE TOOLS:
   ❌ User asks: "suggest", "give examples", "what are some", "can you recommend", "show me options"
   ❌ User explores: "what should I put", "any ideas for", "help me think of"
   ❌ NEVER call tools just because you're discussing a topic - wait for explicit action request

3. CONTEXT RESET RULE:
   After providing suggestions/examples, DO NOT assume the next message wants to use them.
   Each message is independent - check if it contains an action verb.

4. READ BEFORE UPDATE:
   Use get_current_ticket_form when user asks "what is...", "check...", "show current..."

EXAMPLES:

Conversation flow that works correctly:
User: "suggest some titles"
You: [text list, NO tools]
User: "give examples for description"
You: [text list, NO tools] ← RESET context, don't assume we're still updating
User: "ok use option 3"
You: [call update tool] ✓

User: "what time is set?"
You: [call get_current_ticket_form] ✓

Common mistakes to AVOID:
❌ User: "examples?" → You call update tool (WRONG)
❌ Conversation is about tickets → You call tools without action word (WRONG)
❌ You just gave suggestions → Next message auto-updates (WRONG - reset context!)

Remember: Suggestions = TEXT only. Updates = TOOLS only. Check current values = get_current_ticket_form.`
    };
  </script>

  <!-- Ozwell MCP Tools Integration (loads BEFORE embed.js to add tools to config) -->
  <script src="/ozwell-mcp-tools.js"></script>
</head>
<body class="bg-base-100 min-h-screen">
  {{> Template.dynamic template=currentScreen}}

  <!-- Ozwell Embed Script (loads widget iframe from reference server) -->
  <script async src="http://localhost:3000/embed/embed.js"></script>

  <!-- Ozwell Chat Widget Script -->
  <script src="/chat-wrapper.js"></script>

  <!-- iframe-sync Library (for state synchronization) -->
  <script src="http://localhost:3000/embed/iframe-sync.js"></script>

  <!-- Ozwell iframe-sync Integration -->
  <script src="/ozwell-iframe-sync.js"></script>
</body>