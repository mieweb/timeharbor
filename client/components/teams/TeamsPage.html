<template name="teams">
  <h3 class="text-xl font-semibold mb-4">Teams</h3>
  {{#if selectedTeam}}
    <div class="card bg-base-100 shadow p-6 mb-6">
      <button id="backToTeams" class="btn btn-outline mb-4">&larr; Back to Teams</button>
      <h4 class="text-lg font-bold mb-2">{{selectedTeam.name}}</h4>
      <div class="flex items-center gap-2 mb-4">
        <span class="badge bg-neutral text-neutral-content">Join Code: {{selectedTeam.code}}</span>
        <button id="copyTeamCode" class="btn btn-sm btn-outline">Copy Code</button>
      </div>
      <h5 class="font-semibold mb-2">Collaborators:</h5>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
        {{#each selectedTeam.members}}
          <div class="card bg-base-200 shadow-sm p-3 flex items-center justify-between gap-2">
            <div class="flex items-center gap-2 flex-1 min-w-0">
              <span class="font-medium truncate">{{#if this.name}}{{this.name}}{{else}}{{this.email}}{{/if}}</span>
              {{#if isMemberAdmin id}}
                <span class="text-sm text-blue-500 flex-shrink-0" title="Admin">ðŸ‘‘</span>
              {{/if}}
            </div>
            <div class="flex items-center gap-1 flex-shrink-0">
              {{#if canViewMemberDashboard id}}
                <button
                  type="button"
                  class="view-dashboard-btn btn btn-xs btn-ghost text-green-600 hover:text-green-700 hover:bg-green-50"
                  data-member-id="{{id}}"
                  title="View Dashboard"
                >
                  ðŸ“Š
                </button>
              {{/if}}
              {{#if canPromoteToAdmin id}}
                <button
                  type="button"
                  class="promote-admin-btn btn btn-xs btn-ghost text-blue-600 hover:text-blue-700 hover:bg-blue-50"
                  data-member-id="{{id}}"
                  title="Make Admin"
                >
                  â¬†
                </button>
              {{/if}}
              {{#if canDemoteFromAdmin id}}
                <button
                  type="button"
                  class="demote-admin-btn btn btn-xs btn-ghost text-orange-600 hover:text-orange-700 hover:bg-orange-50"
                  data-member-id="{{id}}"
                  title="Remove Admin"
                >
                  â¬‡
                </button>
              {{/if}}
              {{#if canRemoveMember id}}
                <button
                  type="button"
                  class="remove-member-btn btn btn-xs btn-ghost text-red-600 hover:text-red-700 hover:bg-red-50"
                  data-member-id="{{id}}"
                  title="Remove from team"
                >
                  âœ•
                </button>
              {{/if}}
            </div>
          </div>
        {{/each}}
      </div>
    </div>
  {{else}}
    <div class="flex gap-4 mb-4">
      <button id="showCreateTeamForm" class="btn bg-primary hover:bg-primary-focus text-primary-content">Create Team</button>
      <button id="showJoinTeamForm" class="btn bg-gray-700 text-white hover:bg-opacity-90">Join Team</button>
    </div>
    {{#if showCreateTeam}}
      <form id="createTeamForm" class="card bg-base-100 shadow p-4 mb-4 flex flex-col gap-2">
        <input type="text" name="teamName" placeholder="Team Name" class="input input-bordered" required />
        <div class="flex gap-2">
          <button type="submit" class="btn btn-primary">Create</button>
          <button type="button" id="cancelCreateTeam" class="btn btn-outline">Cancel</button>
        </div>
      </form>
    {{/if}}
    {{#if showJoinTeam}}
      <form id="joinTeamForm" class="card bg-base-100 shadow p-4 mb-4 flex flex-col gap-2">
        <input type="text" name="teamCode" placeholder="Enter Team Code" class="input input-bordered" required />
        <div class="flex gap-2">
          <button type="submit" class="btn bg-gray-700 text-white hover:bg-opacity-90">Join</button>
          <button type="button" id="cancelJoinTeam" class="btn btn-outline">Cancel</button>
        </div>
      </form>
    {{/if}}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      {{#each userTeams}}
        <div class="card bg-base-100 shadow p-4">
          <div class="flex items-start justify-between gap-2">
            <a href="#" class="link team-link text-lg font-semibold" data-id="{{_id}}">{{name}}</a>
            {{#if isAdmin _id}}
              <div class="flex items-center gap-2">
                <button class="edit-team-btn text-blue-600 hover:text-blue-800" data-id="{{_id}}" title="Edit Team">
                  <i class="fa-solid fa-pen text-primary"></i>
                </button>
                <button class="delete-team-btn text-red-600 hover:text-red-800" data-id="{{_id}}" title="Delete Team">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </div>
            {{/if}}
          </div>
        </div>
      {{/each}}
    </div>
  {{/if}}
</template>

