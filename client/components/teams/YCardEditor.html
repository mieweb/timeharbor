<template name="ycardEditor">
  <div class="ycard-editor-container">
    <div class="card bg-base-100 shadow p-6 mb-6">
      <h4 class="text-lg font-bold mb-4">Team Contacts</h4>
      
      {{#if showEditor}}
        <div class="mb-4">
          <label class="label">
            <span class="label-text font-semibold">yCard YAML Editor</span>
            <span class="label-text-alt">
              <button id="loadSample" class="btn btn-xs btn-outline btn-primary">Load Sample</button>
              <button id="togglePreview" class="btn btn-xs btn-outline ml-2">
                {{#if showPreview}}Hide Preview{{else}}Show Preview{{/if}}
              </button>
            </span>
          </label>
          
          <div class="mb-2">
            <div class="text-sm text-gray-600">
              Add your team contacts using yCard YAML format. 
              <a href="https://github.com/mieweb/yCard" target="_blank" class="link link-primary">Learn more about yCard</a>
            </div>
          </div>
          
          <textarea 
            id="ycardTextarea" 
            class="textarea textarea-bordered w-full font-mono text-sm"
            rows="12"
            placeholder="Paste your yCard YAML here or click 'Load Sample' to get started...">{{yCardData}}</textarea>
          
          {{#if validationErrors.length}}
            <div class="alert alert-error mt-2">
              <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                <div>
                  <strong>Validation Errors:</strong>
                  <ul class="list-disc list-inside mt-1">
                    {{#each validationErrors}}
                      <li>{{this}}</li>
                    {{/each}}
                  </ul>
                </div>
              </div>
            </div>
          {{else}}
            {{#if yCardData}}
              <div class="alert alert-success mt-2">
                <div>
                  <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                  <span>yCard is valid! {{parsedPeople.length}} contact(s) found.</span>
                </div>
              </div>
            {{/if}}
          {{/if}}
          
          <div class="flex gap-2 mt-4">
            <button id="saveContacts" class="btn btn-primary" {{#if validationErrors.length}}disabled{{/if}}>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              Save Contacts
            </button>
            <button id="cancelEditor" class="btn btn-outline">Cancel</button>
          </div>
        </div>
        
        {{#if showPreview}}
          <div class="divider">Preview</div>
          <div class="ycard-preview">
            {{#if parsedPeople.length}}
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                {{#each parsedPeople}}
                  {{> ycardPersonCard}}
                {{/each}}
              </div>
              
              {{#if hierarchyData.length}}
                <div class="divider">Organization Chart</div>
                <div class="ycard-hierarchy">
                  {{#each hierarchyData}}
                    {{> ycardHierarchyNode}}
                  {{/each}}
                </div>
              {{/if}}
            {{else}}
              <div class="text-gray-500 italic">No valid contacts to preview</div>
            {{/if}}
          </div>
        {{/if}}
      {{else}}
        <div class="contacts-display">
          {{#if contacts.length}}
            <div class="mb-4">
              <div class="flex items-center justify-between">
                <div class="text-sm text-gray-600">
                  {{contacts.length}} contact(s) in this project
                </div>
                <button id="editContacts" class="btn btn-sm btn-outline">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                  </svg>
                  Edit Contacts
                </button>
              </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              {{#each contacts}}
                {{> ycardPersonCard}}
              {{/each}}
            </div>
            
            {{#if hierarchyData.length}}
              <div class="divider">Organization Chart</div>
              <div class="ycard-hierarchy">
                {{#each hierarchyData}}
                  {{> ycardHierarchyNode}}
                {{/each}}
              </div>
            {{/if}}
          {{else}}
            <div class="text-center py-12">
              <div class="mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
              </div>
              <div class="text-gray-500 mb-4 text-lg">No contacts added yet</div>
              <div class="text-gray-400 text-sm mb-6">Add team contacts using yCard to manage your project team and display organizational hierarchy.</div>
              <button id="addContacts" class="btn btn-primary">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                </svg>
                Add Contacts
              </button>
            </div>
          {{/if}}
        </div>
      {{/if}}
    </div>
  </div>
</template>

<template name="ycardPersonCard">
  <div class="card bg-base-200 p-4 ycard-person-card">
    <div class="flex items-start justify-between">
      <div class="flex-1">
        <div class="flex items-center gap-2 mb-2">
          <div class="avatar placeholder">
            <div class="bg-neutral-focus text-neutral-content rounded-full w-10 h-10">
              <span class="text-sm font-semibold">{{#if name}}{{substr name 0 1}}{{else}}?{{/if}}{{#if surname}}{{substr surname 0 1}}{{/if}}</span>
            </div>
          </div>
          <div>
            <h5 class="font-semibold text-lg mb-0">
              {{name}}{{#if surname}} {{surname}}{{/if}}
            </h5>
            {{#if title}}
              <div class="text-sm text-gray-600">{{title}}</div>
            {{/if}}
          </div>
        </div>
        
        <div class="flex flex-wrap gap-1 mb-3">
          {{#if org}}
            <div class="badge badge-neutral badge-sm">{{org}}</div>
          {{/if}}
          {{#if org_unit}}
            <div class="badge badge-ghost badge-sm">{{org_unit}}</div>
          {{/if}}
        </div>
        
        <div class="text-sm space-y-2">
          {{#if email}}
            <div class="flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
              </svg>
              <a href="mailto:{{email}}" class="link link-primary text-sm">{{email}}</a>
            </div>
          {{/if}}
          
          {{#if phone}}
            <div class="flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
              </svg>
              <span class="text-sm">{{#if phone.number}}{{phone.number}}{{else}}{{phone}}{{/if}}</span>
            </div>
          {{/if}}
          
          {{#if manager}}
            <div class="flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
              <span class="text-sm text-gray-600">Reports to: {{manager}}</span>
            </div>
          {{/if}}
        </div>
      </div>
    </div>
  </div>
</template>

<template name="ycardHierarchyNode">
  <div class="hierarchy-node">
    <div class="node-content bg-primary text-primary-content p-3 rounded-lg mb-2 inline-block min-w-48">
      <div class="flex items-center gap-2">
        <div class="avatar placeholder">
          <div class="bg-primary-focus text-primary-content rounded-full w-8 h-8">
            <span class="text-xs font-semibold">{{#if name}}{{substr name 0 1}}{{else}}?{{/if}}{{#if surname}}{{substr surname 0 1}}{{/if}}</span>
          </div>
        </div>
        <div>
          <div class="font-semibold text-sm">{{name}}{{#if surname}} {{surname}}{{/if}}</div>
          {{#if title}}<div class="text-xs opacity-90">{{title}}</div>{{/if}}
        </div>
      </div>
    </div>
    
    {{#if children.length}}
      <div class="children ml-6 pl-4 border-l-2 border-gray-300">
        {{#each children}}
          {{> ycardHierarchyNode}}
        {{/each}}
      </div>
    {{/if}}
  </div>
</template>