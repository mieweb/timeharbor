<template name="timesheet">
  <!-- Header -->
  <div class="flex flex-col sm:flex-row sm:items-center gap-3 mb-6">
    <button id="backToHome" class="btn btn-outline btn-primary btn-sm sm:btn-md w-fit">&larr; Back</button>
    <h3 class="text-xl sm:text-2xl font-bold text-base-content">
      {{#if isOwnTimesheet}}
        My Timesheet
      {{else}}
        Individual Timesheet
      {{/if}}
    </h3>
  </div>

  <!-- User Info Card -->
  <div class="card bg-base-100 shadow p-4 sm:p-6 mb-6">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
      <div>
        <h4 class="text-lg sm:text-xl font-semibold text-base-content">{{userName}}</h4>
        <p class="text-base-content opacity-70 text-sm sm:text-base">{{userEmail}}</p>
      </div>
      <div>
        <div class="badge badge-primary badge-md sm:badge-lg">Total: {{totalHours}}</div>
      </div>
    </div>
  </div>

  <!-- Date Filter -->
  <div class="mb-6 space-y-3">
    <!-- Date inputs row -->
    <div class="flex flex-col sm:flex-row sm:items-center gap-2">
      <label class="font-medium text-sm sm:text-base text-base-content">Date Range:</label>
      <div class="flex items-center gap-2 flex-1">
        <input type="date" id="start-date" class="input input-bordered input-sm sm:input-md flex-1 min-w-0" value="{{startDate}}">
        <span class="opacity-60 text-sm">to</span>
        <input type="date" id="end-date" class="input input-bordered input-sm sm:input-md flex-1 min-w-0" value="{{endDate}}">
      </div>
    </div>
    <!-- Preset buttons row - scrollable on mobile -->
    <div class="flex items-center gap-2 overflow-x-auto pb-2">
      <button id="preset-today" class="btn btn-sm whitespace-nowrap {{#if isPresetSelected 'today'}}btn-primary{{else}}btn-outline{{/if}}">Today</button>
      <button id="preset-yesterday" class="btn btn-sm whitespace-nowrap {{#if isPresetSelected 'yesterday'}}btn-primary{{else}}btn-outline{{/if}}">Yesterday</button>
      <button id="preset-last7" class="btn btn-sm whitespace-nowrap {{#if isPresetSelected 'last7'}}btn-primary{{else}}btn-outline{{/if}}">7 Days</button>
      <button id="preset-thisweek" class="btn btn-sm whitespace-nowrap {{#if isPresetSelected 'thisweek'}}btn-primary{{else}}btn-outline{{/if}}">This Week</button>
      <button id="preset-last14" class="btn btn-sm whitespace-nowrap {{#if isPresetSelected 'last14'}}btn-primary{{else}}btn-outline{{/if}}">14 Days</button>
    </div>
  </div>

  <!-- Clock-in Details Grid -->
  <div class="card bg-base-100 shadow p-4 sm:p-6">
    <div class="flex items-center justify-between mb-4">
      <h5 class="text-base sm:text-lg font-semibold text-base-content">Clock-in Details</h5>
      <div class="flex items-center gap-1 sm:gap-2">
        <span class="text-xs sm:text-sm text-base-content opacity-70 hidden sm:inline" id="clockInCount">Loading...</span>
        <button id="refreshData" class="btn btn-sm btn-outline btn-primary btn-square sm:btn-circle" title="Refresh Data">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
          </svg>
        </button>
        <button id="editClockins" class="btn btn-sm hidden md:inline-flex {{#if isEditMode}}btn-primary{{else}}btn-outline{{/if}}" title="{{#if isEditMode}}Save changes{{else}}Edit clock-ins{{/if}}">{{#if isEditMode}}Save{{else}}Edit{{/if}}</button>
      </div>
    </div>
    
    <!-- Mobile Card View -->
    <div id="timesheetMobileCards" class="md:hidden space-y-3 max-h-96 overflow-y-auto">
      {{#each sessionData}}
        <div class="bg-base-200 rounded-lg p-3">
          <div class="flex justify-between items-start mb-2">
            <div class="text-sm font-medium">{{formatDateCard date}}</div>
            {{#if isActive}}
              <span class="badge badge-success badge-sm gap-1">
                <span class="w-1.5 h-1.5 bg-white rounded-full animate-pulse"></span>
                Active
              </span>
            {{else}}
              <span class="badge badge-ghost badge-sm">Done</span>
            {{/if}}
          </div>
          <div class="flex justify-between items-center">
            <div>
              <span class="text-lg font-bold text-primary">{{formatDurationCard duration isActive}}</span>
              <span class="text-xs text-base-content opacity-60 ml-2">
                {{formatTimeCard startTime}} - {{#if endTime}}{{formatTimeCard endTime}}{{else}}now{{/if}}
              </span>
            </div>
          </div>
          {{#if teamName}}
            <div class="text-xs text-primary opacity-80 mt-1">
              {{teamName}}
            </div>
          {{/if}}
          {{#if ticketsWorkedOn.length}}
            <div class="mt-3 pt-2 border-t border-base-300">
              <div class="text-[10px] uppercase tracking-wider text-base-content/50 font-semibold mb-1.5">Tickets worked on</div>
              <div class="flex flex-wrap gap-2">
                {{#each ticketsWorkedOn}}
                  {{#if url}}
                    <a href="{{url}}" target="_blank" rel="noopener noreferrer" class="timesheet-ticket-link inline-flex items-center gap-1.5 rounded-full px-3 py-2.5 text-xs font-medium bg-primary/15 text-primary hover:bg-primary hover:text-primary-content transition-all duration-200 no-underline shadow-sm hover:shadow border border-primary/20 hover:border-primary touch-manipulation min-h-[44px] min-w-[44px]">
                      <span class="truncate max-w-[140px]">{{title}}</span>
                      <span class="text-[10px] opacity-80 shrink-0">({{durationFormatted}})</span>
                      <svg class="w-3 h-3 shrink-0 opacity-70" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                    </a>
                  {{else}}
                    <span class="inline-flex items-center gap-1.5 rounded-full px-3 py-1.5 text-xs font-medium bg-base-300/80 text-base-content/90 border border-base-300 truncate max-w-[160px]"><span class="truncate">{{title}}</span><span class="text-[10px] opacity-80 shrink-0">({{durationFormatted}})</span></span>
                  {{/if}}
                {{/each}}
              </div>
            </div>
          {{/if}}
        </div>
      {{else}}
        <div class="text-center py-8 text-base-content opacity-60">
          No clock-ins for selected date range
        </div>
      {{/each}}
    </div>
    
    <!-- Desktop Grid View -->
    <div id="timesheetGrid" class="ag-theme-alpine w-full h-96 border border-base-300 rounded-lg hidden md:block"></div>
  </div>

  <!-- Summary Stats -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
    <div class="card bg-base-100 shadow p-4">
      <div class="text-center">
        <div class="text-2xl font-bold text-primary">{{totalSessions}}</div>
        <div class="text-sm text-base-content opacity-70">Total Clock-ins</div>
      </div>
    </div>
    <div class="card bg-base-100 shadow p-4">
      <div class="text-center">
        <div class="text-2xl font-bold text-primary">{{averageSessionHours}}</div>
        <div class="text-sm text-base-content opacity-70">Avg Clock-in Length</div>
      </div>
    </div>
    <div class="card bg-base-100 shadow p-4">
      <div class="text-center">
        <div class="text-2xl font-bold text-primary">{{workingDays}}</div>
        <div class="text-sm text-base-content opacity-70">Working Days</div>
      </div>
    </div>
  </div>
</template>
