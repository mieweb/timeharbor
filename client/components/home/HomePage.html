<template name="home">
  <!-- Welcome Header -->
  <div class="mb-8">
    <h2 class="text-2xl font-bold text-base-content mb-4">Welcome to TimeHarbor</h2>
    <p class="text-base-content opacity-70 mb-6">
      Track your time efficiently across teams and projects.
    </p>
  </div>

  <!-- First Time User / No Data State -->
  {{#if isFirstTimeUser}}
    <div class="card bg-base-100 shadow-lg p-8 mb-8">
      <div class="text-center">
        <div class="text-6xl mb-4">üöÄ</div>
        <h3 class="text-2xl font-bold text-base-content mb-4">Welcome to TimeHarbor!</h3>
        <p class="text-base-content opacity-70 mb-6 max-w-md mx-auto">
          Get started by joining a team or creating your first project. Your time tracking journey begins here!
        </p>
               <div class="flex flex-col sm:flex-row gap-4 justify-center">
                 <button id="joinTeam" class="btn btn-primary">
                   üìã Join a Team
                 </button>
                 <button id="viewGuide" class="btn btn-outline">
                   üìñ View Guide
                 </button>
               </div>
      </div>
    </div>
  {{/if}}

  <!-- Push Notifications Section (for Admins) -->
  {{#if isTeamAdmin}}
    {{> notificationSettings}}
  {{/if}}

  <!-- Team Dashboard Section (for Admins) -->
  {{#if isTeamAdmin}}
    <div class="mb-12">
      <h3 class="text-xl font-semibold mb-4">Team Dashboard</h3>
      
      <!-- Date Range Filter -->
      <div class="mb-6 space-y-3">
        <!-- Date inputs row -->
        <div class="flex flex-col sm:flex-row sm:items-center gap-2">
          <label class="font-medium text-sm sm:text-base">Date Range:</label>
          <div class="flex items-center gap-2 flex-1">
            <input type="date" id="start-date" class="input input-bordered input-sm sm:input-md flex-1 min-w-0" value="{{startDate}}">
            <span class="opacity-60 text-sm">to</span>
            <input type="date" id="end-date" class="input input-bordered input-sm sm:input-md flex-1 min-w-0" value="{{endDate}}">
          </div>
        </div>
        <!-- Preset buttons row - scrollable on mobile -->
        <div class="flex items-center gap-2 overflow-x-auto pb-2">
          <button id="apply-range" class="btn btn-sm whitespace-nowrap {{#if isPresetSelected 'custom'}}btn-primary{{else}}btn-outline{{/if}}">Apply</button>
          <button id="preset-today" class="btn btn-sm whitespace-nowrap {{#if isPresetSelected 'today'}}btn-primary{{else}}btn-outline{{/if}}">Today</button>
          <button id="preset-yesterday" class="btn btn-sm whitespace-nowrap {{#if isPresetSelected 'yesterday'}}btn-primary{{else}}btn-outline{{/if}}">Yesterday</button>
          <button id="preset-last7" class="btn btn-sm whitespace-nowrap {{#if isPresetSelected 'last7'}}btn-primary{{else}}btn-outline{{/if}}">7 Days</button>
          <button id="preset-thisweek" class="btn btn-sm whitespace-nowrap {{#if isPresetSelected 'thisweek'}}btn-primary{{else}}btn-outline{{/if}}">This Week</button>
          <button id="preset-last14" class="btn btn-sm whitespace-nowrap {{#if isPresetSelected 'last14'}}btn-primary{{else}}btn-outline{{/if}}">14 Days</button>
        </div>
      </div>

      <!-- Team Summary - Mobile Card View -->
      <div id="teamMobileCards" class="md:hidden space-y-3">
        {{#each teamMemberSummaryData}}
          <div class="card bg-base-100 shadow-sm border border-base-300 p-4 cursor-pointer hover:bg-base-200" data-user-id="{{userId}}">
            <div class="flex justify-between items-start mb-2">
              <div>
                <div class="font-semibold text-primary">{{displayName}}</div>
                <div class="text-xs text-base-content opacity-60">{{formatDateForCard date}}</div>
              </div>
              <div class="text-right">
                {{#if hasActiveSession}}
                  <span class="badge badge-success badge-sm gap-1">
                    <span class="w-1.5 h-1.5 bg-white rounded-full animate-pulse"></span>
                    Active
                  </span>
                {{else}}
                  <span class="badge badge-ghost badge-sm">Done</span>
                {{/if}}
              </div>
            </div>
            <div class="flex justify-between items-center">
              <div class="text-lg font-bold text-primary">{{formatHoursForCard totalSeconds}}</div>
              {{#if firstClockIn}}
                <div class="text-xs text-base-content opacity-70">
                  {{formatTimeForCard firstClockIn}} - {{#if lastClockOut}}{{formatTimeForCard lastClockOut}}{{else}}now{{/if}}
                </div>
              {{/if}}
            </div>
          </div>
        {{else}}
          <div class="text-center py-8 text-base-content opacity-60">
            No team activity for selected date range
          </div>
        {{/each}}
      </div>

      <!-- Team Summary - Desktop Grid View -->
      <div id="teamDashboardGrid" class="ag-theme-alpine w-full h-96 hidden md:block"></div>
    </div>
  {{/if}}

  <!-- Personal Dashboard Section (for all users) -->
  <div class="mb-8">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-6">
      <h3 class="text-lg sm:text-xl font-semibold">Your Personal Dashboard</h3>
      <div class="flex flex-wrap gap-2">
        <button id="viewMyTimesheet" class="btn btn-xs sm:btn-sm btn-outline btn-primary">
          View Timesheet
        </button>
        <button id="reportIssue" class="btn btn-xs sm:btn-sm btn-outline btn-secondary">
          Report Issue
        </button>
      </div>
    </div>

    <!-- Quick Stats Cards -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-2 sm:gap-4 mb-6">
      <div class="card bg-base-100 shadow p-3 sm:p-4">
        <div class="text-center">
          <div class="text-xl sm:text-2xl font-bold text-primary">{{todayHours}}</div>
          <div class="text-xs sm:text-sm text-base-content opacity-70">Today</div>
        </div>
      </div>
      <div class="card bg-base-100 shadow p-3 sm:p-4">
        <div class="text-center">
          <div class="text-xl sm:text-2xl font-bold text-primary">{{weekHours}}</div>
          <div class="text-xs sm:text-sm text-base-content opacity-70">This Week</div>
        </div>
      </div>
      <div class="card bg-base-100 shadow p-3 sm:p-4">
        <div class="text-center">
          <div class="text-xl sm:text-2xl font-bold text-primary">{{activeSessionsCount}}</div>
          <div class="text-xs sm:text-sm text-base-content opacity-70">Active</div>
        </div>
      </div>
      <div class="card bg-base-100 shadow p-3 sm:p-4">
        <div class="text-center">
          <div class="text-xl sm:text-2xl font-bold text-primary">{{totalProjects}}</div>
          <div class="text-xs sm:text-sm text-base-content opacity-70">Teams</div>
        </div>
      </div>
    </div>

    <!-- Recent Activity -->
    <div class="card bg-base-100 shadow p-4 sm:p-6">
      <h4 class="text-base sm:text-lg font-semibold mb-4">Recent Activity</h4>
      
      {{#if hasRecentActivity}}
        <div class="space-y-3">
          {{#each recentClockEvents}}
            <div class="flex items-center justify-between gap-2 p-2 sm:p-3 bg-base-200 rounded-lg">
              <div class="flex items-center gap-2 sm:gap-3 min-w-0 flex-1">
                <div class="text-lg sm:text-2xl shrink-0">
                  {{#if endTime}}
                    ‚úÖ
                  {{else}}
                    üü¢
                  {{/if}}
                </div>
                <div class="min-w-0 flex-1">
                  <div class="font-semibold text-sm sm:text-base truncate">{{teamName teamId}}</div>
                  <div class="text-xs sm:text-sm text-base-content opacity-70">
                    {{#if endTime}}
                      {{formatTimestampHoursMinutes startTimestamp}} - {{formatTimestampHoursMinutes endTime}}
                    {{else}}
                      {{formatTimestampHoursMinutes startTimestamp}} (Active)
                    {{/if}}
                  </div>
                </div>
              </div>
              <div class="text-right shrink-0">
                <div class="badge badge-primary badge-sm sm:badge-md">{{formatTimeHoursMinutes (clockEventTotalTime this)}}</div>
                {{#unless endTime}}
                  <div class="text-xs text-success mt-1">Running</div>
                {{/unless}}
              </div>
            </div>
          {{/each}}
        </div>
      {{else}}
        <div class="text-center py-8">
          <div class="text-4xl mb-4">‚è∞</div>
          <p class="text-base-content opacity-70 mb-4">No recent activity found</p>
          <p class="text-sm text-base-content opacity-60">Start tracking your time by clocking into a project!</p>
        </div>
      {{/if}}
    </div>
  </div>
</template>