<template name="home">
  <!-- Welcome Header -->
  <div class="mb-8">
    <h2 class="text-2xl font-bold text-base-content mb-4">Welcome to TimeHarbor</h2>
    <p class="text-base-content opacity-70 mb-6">
      Track your time efficiently across teams and projects.
    </p>
  </div>

  <!-- First Time User / No Data State -->
  {{#if isFirstTimeUser}}
    <div class="card bg-base-100 shadow-lg p-8 mb-8">
      <div class="text-center">
        <div class="text-6xl mb-4">üöÄ</div>
        <h3 class="text-2xl font-bold text-base-content mb-4">Welcome to TimeHarbor!</h3>
        <p class="text-base-content opacity-70 mb-6 max-w-md mx-auto">
          Get started by joining a team or creating your first project. Your time tracking journey begins here!
        </p>
               <div class="flex flex-col sm:flex-row gap-4 justify-center">
                 <button id="joinTeam" class="btn btn-primary">
                   üìã Join a Team
                 </button>
                 <button id="viewGuide" class="btn btn-outline">
                   üìñ View Guide
                 </button>
               </div>
      </div>
    </div>
  {{/if}}

  <!-- Team Dashboard Section (for Admins/Leaders) -->
  {{#if isTeamLeader}}
    <div class="mb-12">
      <h3 class="text-xl font-semibold mb-4">Team Dashboard</h3>
      
      <!-- Date Range Filter -->
      <div class="mb-6 flex flex-wrap items-center gap-4">
        <label class="font-medium">Date Range:</label>
        <input type="date" id="start-date" class="input input-bordered" value="{{startDate}}">
        <span class="opacity-60">to</span>
        <input type="date" id="end-date" class="input input-bordered" value="{{endDate}}">
         <div class="flex items-center gap-2">
           <button id="apply-range" class="btn btn-sm {{#if isPresetSelected 'custom'}}btn-primary{{else}}btn-outline{{/if}}">Apply</button>
           <button id="preset-today" class="btn btn-sm {{#if isPresetSelected 'today'}}btn-primary{{else}}btn-outline{{/if}}">Today</button>
           <button id="preset-yesterday" class="btn btn-sm {{#if isPresetSelected 'yesterday'}}btn-primary{{else}}btn-outline{{/if}}">Yesterday</button>
           <button id="preset-last7" class="btn btn-sm {{#if isPresetSelected 'last7'}}btn-primary{{else}}btn-outline{{/if}}">Last 7 Days</button>
           <button id="preset-thisweek" class="btn btn-sm {{#if isPresetSelected 'thisweek'}}btn-primary{{else}}btn-outline{{/if}}">This Week</button>
           <button id="preset-last14" class="btn btn-sm {{#if isPresetSelected 'last14'}}btn-primary{{else}}btn-outline{{/if}}">Last 14 Days</button>
         </div>
      </div>

      <!-- Team Summary Grid -->
      <div id="teamDashboardGrid" class="ag-theme-alpine w-full h-96"></div>
    </div>
  {{/if}}

  <!-- Personal Dashboard Section (for all users) -->
  <div class="mb-8">
    <div class="flex items-center justify-between mb-6">
      <h3 class="text-xl font-semibold">Your Personal Dashboard</h3>
      <div class="flex gap-2">
        <button id="viewMyTimesheet" class="btn btn-sm btn-outline btn-primary">
          üìä View My Timesheet
        </button>
        <button id="reportIssue" class="btn btn-sm btn-outline btn-secondary">
          üêõ Report an Issue
        </button>
      </div>
    </div>

    <!-- Quick Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
      <div class="card bg-base-100 shadow p-4">
        <div class="text-center">
          <div class="text-2xl font-bold text-primary">{{todayHours}}</div>
          <div class="text-sm text-base-content opacity-70">Today's Hours</div>
        </div>
      </div>
      <div class="card bg-base-100 shadow p-4">
        <div class="text-center">
          <div class="text-2xl font-bold text-primary">{{weekHours}}</div>
          <div class="text-sm text-base-content opacity-70">This Week</div>
        </div>
      </div>
      <div class="card bg-base-100 shadow p-4">
        <div class="text-center">
          <div class="text-2xl font-bold text-primary">{{activeSessionsCount}}</div>
          <div class="text-sm text-base-content opacity-70">Active Clock-ins</div>
        </div>
      </div>
      <div class="card bg-base-100 shadow p-4">
        <div class="text-center">
          <div class="text-2xl font-bold text-primary">{{totalProjects}}</div>
          <div class="text-sm text-base-content opacity-70">Active Teams</div>
        </div>
      </div>
    </div>

    <!-- Recent Activity -->
    <div class="card bg-base-100 shadow p-6">
      <h4 class="text-lg font-semibold mb-4">Recent Activity</h4>
      
      {{#if hasRecentActivity}}
        <div class="space-y-4">
          {{#each recentClockEvents}}
            <div class="flex items-center justify-between p-3 bg-base-200 rounded-lg">
              <div class="flex items-center gap-3">
                <div class="text-2xl">
                  {{#if endTime}}
                    ‚úÖ
                  {{else}}
                    üü¢
                  {{/if}}
                </div>
                <div>
                  <div class="font-semibold">{{teamName teamId}}</div>
                  <div class="text-sm text-base-content opacity-70">
                    {{#if endTime}}
                      {{formatDate startTimestamp}} - {{formatDate endTime}}
                    {{else}}
                      Started {{formatDate startTimestamp}} (Active)
                    {{/if}}
                  </div>
                </div>
              </div>
              <div class="text-right">
                <div class="badge badge-primary">{{formatTime (clockEventTotalTime this)}}</div>
                {{#unless endTime}}
                  <div class="text-xs text-success mt-1">Running</div>
                {{/unless}}
              </div>
            </div>
          {{/each}}
        </div>
      {{else}}
        <div class="text-center py-8">
          <div class="text-4xl mb-4">‚è∞</div>
          <p class="text-base-content opacity-70 mb-4">No recent activity found</p>
          <p class="text-sm text-base-content opacity-60">Start tracking your time by clocking into a project!</p>
        </div>
      {{/if}}
    </div>

    <!-- Active Clock-ins (if any) -->
    {{#if hasActiveSessions}}
      <div class="card bg-base-100 shadow p-6 mt-6">
        <h4 class="text-lg font-semibold mb-4 text-success">üü¢ Active Clock-ins</h4>
        <div class="space-y-3">
          {{#each activeClockEvents}}
            <div class="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg">
              <div>
                <div class="font-semibold text-success">{{teamName teamId}}</div>
                <div class="text-sm text-base-content opacity-70">
                  Started {{formatDate startTimestamp}}
                </div>
                {{#if tickets}}
                  <div class="text-xs text-base-content opacity-60 mt-1">
                    Working on: {{#each tickets}}{{ticketTitle ticketId}}{{#unless @last}}, {{/unless}}{{/each}}
                  </div>
                {{/if}}
              </div>
              <div class="text-right">
                <div class="badge badge-success">{{formatTime (clockEventTotalTime this)}}</div>
                <div class="text-xs text-success mt-1">Active</div>
              </div>
            </div>
          {{/each}}
        </div>
      </div>
    {{/if}}
  </div>
</template>